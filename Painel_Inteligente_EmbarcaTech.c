#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>
#include "pico/stdlib.h"         // Biblioteca para funções básicas da Raspberry Pi Pico
#include "pico/binary_info.h"    // Biblioteca para informações binárias
#include "inc/ssd1306.h"         // Biblioteca para controlar o display OLED SSD1306
#include "hardware/i2c.h"        // Biblioteca para trabalhar com I2C


// Definindo os pinos do I2C
const uint I2C_SDA = 14;  // Pino SDA para comunicação I2C
const uint I2C_SCL = 15;  // Pino SCL para comunicação I2C

// Função para iniciar a comunicação I2C
void iniciar_comunicacao_i2c() 
{
	i2c_init(i2c1, ssd1306_i2c_clock * 1000);  // Inicializa o I2C com a frequência definida em ssd1306_i2c_clock
    gpio_set_function(I2C_SDA, GPIO_FUNC_I2C); // Configura o pino SDA para a função I2C
    gpio_set_function(I2C_SCL, GPIO_FUNC_I2C); // Configura o pino SCL para a função I2C
    gpio_pull_up(I2C_SDA);  // Habilita o resistor pull-up para o pino SDA
    gpio_pull_up(I2C_SCL);  // Habilita o resistor pull-up para o pino SCL
}

// Função para iniciar o display OLED SSD1306
void iniciar_display() 
{
    ssd1306_init();  // Inicializa o display OLED SSD1306
}


// Função para configurar o display (definir área de renderização)
void configurar_display() 
{
    // Definir a área de renderização do display (tamanho da tela)
    struct render_area frame_area = {
        start_column : 0,                 // Coluna inicial
        end_column : ssd1306_width - 1,  // Coluna final (largura da tela)
        start_page : 0,                 // Página inicial (linha inicial)
        end_page : ssd1306_n_pages - 1 // Página final (total de páginas para a altura da tela)
    };

    calculate_render_area_buffer_length(&frame_area);  // Calcula o comprimento do buffer de renderização

    // Zera o display (preenche com zeros)
    uint8_t ssd[ssd1306_buffer_length];  // Cria um buffer de memória para o display
    memset(ssd, 0, ssd1306_buffer_length);  // Preenche o buffer com zeros
    render_on_display(ssd, &frame_area);  // Renderiza o buffer no display
}


int main() {
	// Inicializando as funções
    stdio_init_all();   
    iniciar_comunicacao_i2c();
	iniciar_display();
	configurar_display();
	
	// Preparar área de renderização para o display (ssd1306_width pixels por ssd1306_n_pages páginas)
    struct render_area frame_area = {
        start_column : 0,
        end_column : ssd1306_width - 1,
        start_page : 0,
        end_page : ssd1306_n_pages - 1
    };

    calculate_render_area_buffer_length(&frame_area);

    // zera o display inteiro
    uint8_t ssd[ssd1306_buffer_length];
    memset(ssd, 0, ssd1306_buffer_length);
    render_on_display(ssd, &frame_area);


    //Exibir mensagem no display
    char *text[] = {
        " Sistema de Notificação Inteligente,   ",
        "   ",
        "Bem-vindo!"};

    int y = 0;
    for (uint i = 0; i < count_of(text); i++)
    {
        ssd1306_draw_string(ssd, 5, y, text[i]);
        y += 8;
    }
    render_on_display(ssd, &frame_area);

    // Adicionar atraso maior para o texto 
	sleep_ms(3000); // 3 segundos (ajuste conforme necessário


	//Exibir o bitmap no display
    const uint8_t bitmap_128x64[] = { 
	 // 'y love (1)', 64x128px
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0x1f, 0x00, 0x00, 0x00, 0x8e, 0xff, 0xff, 0xff, 0x0f, 0x00, 0x00, 0x00, 0x0e, 0xfc, 0xff, 0xff, 
    0x1f, 0x00, 0x00, 0x00, 0x0e, 0xf0, 0xff, 0xff, 0x1f, 0x00, 0x00, 0x00, 0x0e, 0x00, 0xff, 0xff, 
    0x1f, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0xfc, 0x1f, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0xf8, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0x03, 0x00, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0xf8, 
    0xff, 0xff, 0xff, 0xff, 0x1f, 0x00, 0x00, 0xf8, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x00, 0xfe, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0x0f, 0xc0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0f, 0xf8, 0xff, 0xff, 
    0xff, 0x00, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x7f, 0x00, 0xfc, 0xff, 0xef, 0xff, 0xff, 0xff, 
    0x3f, 0x00, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3f, 0x00, 0xe0, 0xff, 0x3f, 0x00, 0x00, 0xff, 
    0x1f, 0x00, 0xc0, 0xff, 0x1f, 0x00, 0x00, 0xfe, 0x1f, 0x00, 0x00, 0xff, 0x0f, 0x00, 0x00, 0xfc, 
    0x1f, 0x00, 0x00, 0xfe, 0x0f, 0x00, 0x00, 0xfc, 0x1f, 0x00, 0x00, 0xfe, 0x0f, 0x00, 0x00, 0xf8, 
    0x1f, 0x00, 0x00, 0xf8, 0x07, 0xff, 0x7f, 0xf8, 0x1f, 0x00, 0x00, 0xf0, 0x8f, 0xff, 0x7f, 0xf8, 
    0x1f, 0x00, 0x00, 0xe0, 0x0f, 0xff, 0x7f, 0xf8, 0x3f, 0x00, 0x00, 0xe0, 0x0f, 0x00, 0x00, 0xf8, 
    0x3f, 0x00, 0x00, 0xc0, 0x0f, 0x00, 0x00, 0xfc, 0x7f, 0x00, 0x00, 0x80, 0x0f, 0x00, 0x00, 0xfc, 
    0xff, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0xde, 0xff, 0x03, 0x00, 0x00, 0x3e, 0x00, 0x00, 0xef, 
    0xff, 0x00, 0x00, 0x00, 0xfe, 0xff, 0xff, 0xff, 0x7f, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xf7, 
    0x3f, 0x00, 0x00, 0x80, 0xdf, 0xff, 0xff, 0xff, 0x3f, 0x00, 0x00, 0xc0, 0x0f, 0x00, 0x00, 0xff, 
    0x1f, 0x00, 0x00, 0xe0, 0x0f, 0x00, 0x00, 0xfe, 0x1f, 0x00, 0x00, 0xf0, 0x0f, 0x00, 0x00, 0xfc, 
    0x1f, 0x00, 0x00, 0x78, 0x0f, 0x00, 0x00, 0xfc, 0x1f, 0x00, 0x00, 0xbc, 0xff, 0xff, 0x1f, 0xf8, 
    0x1f, 0x00, 0x00, 0xde, 0xff, 0xff, 0x7f, 0xf8, 0x1f, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0xf8, 
    0x1f, 0x00, 0x80, 0xff, 0xff, 0xff, 0x3f, 0xf8, 0x3f, 0x00, 0xe0, 0xfb, 0x0f, 0x00, 0x00, 0xf8, 
    0x3f, 0x00, 0xf0, 0xfd, 0x0f, 0x00, 0x00, 0xfc, 0x7f, 0x00, 0xfc, 0xfe, 0x0f, 0x00, 0x00, 0xdc, 
    0xff, 0x00, 0x7f, 0xff, 0x0f, 0x00, 0x00, 0xfe, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x00, 0xc0, 0xef, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfb, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
 
 };

    ssd1306_t ssd_bm;
    ssd1306_init_bm(&ssd_bm, 128, 64, false, 0x3C, i2c1);
    ssd1306_config(&ssd_bm);

    ssd1306_draw_bitmap(&ssd_bm, bitmap_128x64);

    while(true) {
        sleep_ms(1000);
    }

    return 0;
}

